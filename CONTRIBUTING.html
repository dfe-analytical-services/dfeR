<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Contributing to dfeR • dfeR</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png"><link rel="icon" sizes="any" href="favicon.ico"><link rel="manifest" href="site.webmanifest"><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><link href="extra.css" rel="stylesheet"><meta property="og:title" content="Contributing to dfeR"><meta property="og:image" content="https://dfe-analytical-services.github.io/dfeR/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">dfeR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="articles/connecting_to_sql.html">Connecting to SQL</a></li>
    <li><a class="dropdown-item" href="articles/create_new_project.html">Creating a new dfeR project</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/dfe-analytical-services/dfeR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="logo.png" class="logo" alt=""><h1>Contributing to dfeR</h1>
      <small class="dont-index">Source: <a href="https://github.com/dfe-analytical-services/dfeR/blob/v1.1.0/.github/CONTRIBUTING.md" class="external-link"><code>.github/CONTRIBUTING.md</code></a></small>
    </div>

<div id="contributing-to-dfer" class="section level1">

<p>Ideas for dfeR should first be raised as a <a href="https://github.com/dfe-analytical-services/dfeR/issues" class="external-link">GitHub issue</a> after which anyone is free to write the code and create a pull request for review.</p>
<p>For a detailed discussion on contributing to R packages in the tidyverse, please see the <a href="https://rstd.io/tidy-contrib" class="external-link">development contributing guide</a> and their <a href="https://code-review.tidyverse.org/" class="external-link">code review principles</a>. Full knowledge of this isn’t needed, though some awareness of general principles may be useful.</p>
<div class="section level2">
<h2 id="support">Support<a class="anchor" aria-label="anchor" href="#support"></a></h2>
<p>We’re keen for anyone at DfE to be able to feel comfortable contributing to this package. If you have any questions, or would like support in making changes, let the <a href="mailto:statistics.development@education.gov.uk">Statistics Development Team</a> know.</p>
</div>
<div class="section level2">
<h2 id="basics">Basics<a class="anchor" aria-label="anchor" href="#basics"></a></h2>
<p>When contributing to dfeR you should work on a new branch taken from main.</p>
<p>Any pull request must be reviewed and approved by at least one admin user before it can be merged.</p>
<ul><li><p>If you’ve found a bug, please file an issue that illustrates the bug with a minimal <a href="https://www.tidyverse.org/help/#reprex" class="external-link">reprex example</a> (this will also help you write a unit test, if needed).</p></li>
<li><p>See the tidyverse guide on <a href="https://code-review.tidyverse.org/issues/" class="external-link">how to create a great issue</a> for more advice.</p></li>
</ul><div class="section level3">
<h3 id="fixing-typos">Fixing typos<a class="anchor" aria-label="anchor" href="#fixing-typos"></a></h3>
<p>You can fix typos, spelling mistakes, or grammatical errors in the documentation directly using the GitHub web interface, as long as the changes are made in the <em>source</em> file.</p>
<p>This generally means you’ll need to edit <a href="https://roxygen2.r-lib.org/articles/roxygen2.html" class="external-link">roxygen2 comments</a> in an <code>.R</code>, not a <code>.Rd</code> file. You can find the <code>.R</code> file that generates the <code>.Rd</code> by reading the comment in the first line.</p>
</div>
<div class="section level3">
<h3 id="bigger-changes">Bigger changes<a class="anchor" aria-label="anchor" href="#bigger-changes"></a></h3>
<p>If you want to make a bigger change, it’s a good idea to first <a href="https://github.com/dfe-analytical-services/dfeR/issues" class="external-link">file an issue</a> and make sure someone from the team agrees with the change.</p>
<p>Packages worth installing to aid development are:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"usethis"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"pkgdown"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"roxygen2"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"spelling"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"lintr"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"styler"</span><span class="op">)</span></span></code></pre></div>
<p>Where possible, we’d recommend following the <a href="https://testdriven.io/test-driven-development/" class="external-link">Test Driven Development (TDD)</a> approach. Though if you’re new to package development, or already have code for a specific function feel free to start with step 2, to copy the function into the package and then go back to step 1 afterwards.</p>
<ol style="list-style-type: decimal"><li>Write tests using <a href="https://r-pkgs.org/testing-basics.html" class="external-link">testthat</a> for the behaviour you want. Either edit an existing test script, or if adding a new function, create a test script using:</li>
</ol><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/use_r.html" class="external-link">use_test</a></span><span class="op">(</span><span class="st">"name_of_new_function"</span><span class="op">)</span></span></code></pre></div>
<p>Feel free to have a look in the /tests/test_that folder for some examples if you want to see example tests in practice.</p>
<ol start="2" style="list-style-type: decimal"><li>Write just enough code so that the tests pass. Again, either edit an existing function, or add a new R script using:</li>
</ol><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/use_r.html" class="external-link">use_r</a></span><span class="op">(</span><span class="st">"name_of_new_function"</span><span class="op">)</span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal"><li>Add documentation for what you’ve done. Follow the <a href="https://roxygen2.r-lib.org/articles/rd.html" class="external-link">roxygen2</a> pattern for comments. You can add a standard skeleton using <code>Code &gt; Insert Roxygen Skeleton</code> or by <code>Ctrl+Shift+Alt+R</code> when in your R script. Here’s an example of what it looks like for a basic <code>add()</code> function:</li>
</ol><pre><code><span><span class="co">#' @description Add together two numbers</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param x A number.</span></span>
<span><span class="co">#' @param y A number.</span></span>
<span><span class="co">#' @return A number.</span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="co">#' add(1, 1)</span></span>
<span><span class="co">#' add(10, 1)</span></span>
<span><span class="va">add</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span> <span class="op">+</span> <span class="va">y</span></span>
<span><span class="op">}</span></span></code></pre>
<ol start="4" style="list-style-type: decimal"><li><p>Continue to improve code while keeping tests passing.</p></li>
<li><p>Automatically style code using:</p></li>
</ol><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">styler</span><span class="fu">::</span><span class="fu">style_pkg</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<ol start="5" style="list-style-type: decimal"><li>Run a full check of the package using the following functions:</li>
</ol><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">check</span><span class="op">(</span><span class="op">)</span> <span class="co"># General package check, can also use Ctrl-Shift-E</span></span>
<span><span class="fu">lintr</span><span class="fu">::</span><span class="fu">lint_package</span><span class="op">(</span><span class="op">)</span> <span class="co"># Check formatting of code</span></span>
<span><span class="fu">spelling</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/spelling//reference/spell_check_package.html" class="external-link">spell_check_package</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># Check for spelling mistakes</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="handy-workflows">Handy workflows<a class="anchor" aria-label="anchor" href="#handy-workflows"></a></h2>
<p>Keyboard shortcuts for the <code>devtools</code> package to use while in RStudio:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">load_all</span><span class="op">(</span><span class="op">)</span> <span class="co"># (Ctrl-Shift-L): Load code with dfeR package</span></span>
<span><span class="fu">test</span><span class="op">(</span><span class="op">)</span> <span class="co"># (Ctrl-Shift-T): Run tests</span></span>
<span><span class="fu">document</span><span class="op">(</span><span class="op">)</span> <span class="co"># (Ctrl-Shift-D): Rebuild docs and NAMESPACE</span></span>
<span><span class="fu">check</span><span class="op">(</span><span class="op">)</span> <span class="co"># (Ctrl-Shift-E): Check complete package</span></span></code></pre></div>
<p>We recommend using the <a href="https://usethis.r-lib.org/index.html" class="external-link">usethis</a> package where possible for consistency and simplicity.</p>
</div>
<div class="section level2">
<h2 id="adding-package-dependencies">Adding package dependencies<a class="anchor" aria-label="anchor" href="#adding-package-dependencies"></a></h2>
<p>Add any packages the package users will need with:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/use_package.html" class="external-link">use_package</a></span><span class="op">(</span><span class="va">pkgname</span><span class="op">)</span></span></code></pre></div>
<p>Add any packages that package developers only may need with:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/use_package.html" class="external-link">use_package</a></span><span class="op">(</span><span class="va">pkgname</span>, type <span class="op">=</span> <span class="st">"suggests"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="updating-the-readme">Updating the README<a class="anchor" aria-label="anchor" href="#updating-the-readme"></a></h2>
<p>There are two README files that are linked with a pre-commit-hook to ensure they are kept in sync.</p>
<p>Make all changes to the <code>README.Rmd</code> file and then run the following line to rebuild:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">build_readme</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="pkgdown-site">pkgdown site<a class="anchor" aria-label="anchor" href="#pkgdown-site"></a></h2>
<p>Most of the <code>pkgdown</code> site is automatically generated. The theme is set in the <code>_pkgdown.yml</code> file.</p>
<p>Custom CSS can be set in <code>pkgdown/extra.css</code> file. If you make any edits to this file you will need to re-initialise the site using the following line:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pkgdown</span><span class="fu">::</span><span class="fu"><a href="https://pkgdown.r-lib.org/reference/init_site.html" class="external-link">init_site</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>The site is hosted on GitHub pages. You build and preview the pkgdown site locally by running:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">build_site</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="updating-the-package-version">Updating the package version<a class="anchor" aria-label="anchor" href="#updating-the-package-version"></a></h2>
<p>In general, we’ll be working on a ‘development’ version (x.x.x.9000) of the package in between CRAN releases, which should happen no more than every 1-2 months (CRAN recommendation).</p>
<p>Once changes have been completed, reviewed and are ready for use in the wild, you should review the R packages guidance for submitting a new version to CRAN. You can increment the package version using:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/use_version.html" class="external-link">use_version</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>If you are unsure what kind of version to increment, have a look through <a href="https://r-pkgs.org/lifecycle.html#sec-lifecycle-release-type" class="external-link">lifecycle’s guidance on release types</a>.</p>
<p>Once you’ve incremented the version number, it’ll offer to perform a commit on your behalf. As this happens it will add an update to <code>NEWS.md</code>, which acts as the changelog for the package. Make sure this is updated correctly and then push to GitHub.</p>
<p>Once the version has been updated and pushed, and is accepted and working on CRAN create a new GitHub release version.</p>
<p>In case it’s useful, we documented some of the initial CRAN release process and tweaks in <a href="https://github.com/dfe-analytical-services/dfeR/pull/103" class="external-link uri">https://github.com/dfe-analytical-services/dfeR/pull/103</a>.</p>
<div class="section level3">
<h3 id="lifecyles">Lifecyles<a class="anchor" aria-label="anchor" href="#lifecyles"></a></h3>
<p>The package has <a href="https://r-pkgs.org/lifecycle.html" class="external-link">lifecycle</a> imported, follow their guidance for the process around deprecating any functions or arguments.</p>
</div>
</div>
<div class="section level2">
<h2 id="code-style">Code style<a class="anchor" aria-label="anchor" href="#code-style"></a></h2>
<p>New code should follow the tidyverse <a href="https://style.tidyverse.org" class="external-link">style guide</a>. We use <a href="https://lintr.r-lib.org/articles/lintr.html" class="external-link">lintr</a> to scan styling on pull requests, this will automatically run and add comments for any code that is failing the standards we’d expect. Where these happen, please proactively resolve these as we are unlikely to approve pull requests that have styling issues.</p>
<p>You can use the <a href="https://CRAN.R-project.org/package=styler" class="external-link">styler</a> package to apply most of the styling using:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">styler</span><span class="fu">::</span><span class="fu">style_pkg</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>To check for any further styling issues locally, use:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">lintr</span><span class="fu">::</span><span class="fu">lint_package</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><a href="https://CRAN.R-project.org/package=styler" class="external-link">styler</a> will not fix all linting issues, so we recommend using that first, then using <a href="https://lintr.r-lib.org/articles/lintr.html" class="external-link">lintr</a> to check for places you may need to manually fix styling issues such as line length or not using snake_case.</p>
</div>
<div class="section level2">
<h2 id="folder-and-script-structure-conventions">Folder and script structure conventions<a class="anchor" aria-label="anchor" href="#folder-and-script-structure-conventions"></a></h2>
<p>In an R package you are not allowed to have any sub directories in the R/ folder. Where possible we should have:</p>
<ul><li>one script per function or</li>
<li>one script per function family if a function belongs to a family</li>
</ul><p>The script should share the name of the function or family. If needed then a <family>_utils.R script should be used for internal only functions that relate to a specific family.</family></p>
<p>Documentation for all data shipped with the packages is kept in <code>R/datasets_documentation.R</code>. Scripts used for preparing data used in the package is not in the R folder, it is in the <code>data-raw/</code> folder, helper functions for this can be found in the <code>R/datasets_utils.R</code> folder, and more details on maintaining the data sets can be found under the <a href="#package-data">Package data</a> header on this page.</p>
<p><code>utils.R</code> should be used to hold any cross-package helpers that aren’t exported as functions or specific to a family.</p>
<p>Every exported function or data set gets its own test script, called <code>test-&lt;function-name&gt;.R</code> or <code>test-data-&lt;data-name&gt;.R</code> if for a data set.</p>
<div class="section level3">
<h3 id="testing">Testing<a class="anchor" aria-label="anchor" href="#testing"></a></h3>
<p>We use <a href="https://cran.r-project.org/package=testthat" class="external-link">testthat</a> for unit tests, we expect all new functions to have some level of test coverage.</p>
<p>If you want to see examples of existing tests for inspiration, take a look inside the <code>tests/testthat/</code> folder.</p>
</div>
<div class="section level3">
<h3 id="test-coverage">Test coverage<a class="anchor" aria-label="anchor" href="#test-coverage"></a></h3>
<p>There are GitHub Actions workflows that check and link the package to <a href="https://app.codecov.io/gh/dfe-analytical-services/" class="external-link">codecov.io</a>, this runs automatic scans to check the % of lines in functions that we are testing. On the <a href="https://app.codecov.io/gh/dfe-analytical-services/dfeR" class="external-link">dfeR codecov pages</a> you can preview the variation by branch and commit to see the impact of changes made.</p>
<p>You will need to create an account or login using GitHub to see the pages.</p>
<p>The current % of coverage is shown as a badge on the package <a href="https://github.com/dfe-analytical-services/dfeR" class="external-link">README on GitHub</a>.</p>
<p>It is worth noting that 100% coverage does not mean that the tests are perfect, it only means that all lines are ran in tests, so it’s more a measure of quantity rather than quality. Interesting to see all the same though, and we’d recommend using it to spot any potential elements of more complicated functions that you may have forgotten to test.</p>
</div>
<div class="section level3">
<h3 id="spelling">Spelling<a class="anchor" aria-label="anchor" href="#spelling"></a></h3>
<p>The <a href="https://docs.ropensci.org/spelling/" class="external-link">spelling</a> package is used to check spelling. A custom word list of exceptions for this package exists in the <code>inst/</code> folder.</p>
<p>There will be messages in the <code>devtools::check()</code> output if there’s potential spelling errors. Please review and fix any genuine errors.</p>
<p>You can run a check yourself using:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">spelling</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/spelling//reference/spell_check_package.html" class="external-link">spell_check_package</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>To automatically pick up genuine new words in the package and add to this list, use:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">spelling</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/spelling//reference/wordlist.html" class="external-link">update_wordlist</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="adding-vignettes">Adding vignettes<a class="anchor" aria-label="anchor" href="#adding-vignettes"></a></h2>
<p>Vignettes can be found in the <code>vignettes/</code> folder as .Rmd files. To start a new one use:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/use_vignette.html" class="external-link">use_vignette</a></span><span class="op">(</span><span class="st">"name_of_vignette"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="package-data">Package data<a class="anchor" aria-label="anchor" href="#package-data"></a></h2>
<p>Our general workflow for data in the package is:</p>
<ol start="0" style="list-style-type: decimal"><li>Make sure you have everything you need installed and the package is loaded with <code>devtools::load_all()</code>
</li>
<li>Use the relevant script in data-raw/ to generate and save the data set</li>
<li>Document the data set in R/datasets_documentation.R</li>
<li>Update any relevant fetch_ functions that use the data if appropriate</li>
<li>Run all the usual package checks and re-documenting of the package as you would for any other update</li>
</ol><p>Our general principle is that all data should be created through reproducible code, so if it’s custom data you’re defining, write it in code. If you’re sourcing it from elsewhere, try to make use of API connections. This saves on unnecessary data storage bloat and makes our scripts nice and reproducible without external dependencies to worry about.</p>
<p>We try to keep the data-raw/ scripts as tidy as possible, so some helper functions have been created in R/datasets-utils.R. These are not exported for users of the package and are only used by scripts in the data-raw/ folder for the creation of data exported in the package.</p>
<p>Sometimes when running the scripts to create new data sets you might hit this error:</p>
<pre><code>Error in `check_is_package()`:
i use_data() is designed to work with packages
X Project "some letters and numbers" is not an R package.
</code></pre>
<p>If you do, try restarting R, making sure you have the project open, and the package loaded using <code>devtools::load_all()</code> and then run again.</p>
<p>For more details on maintaining data with an R package generally, see <a href="https://r-pkgs.org/data.html" class="external-link">chapter 7 Data, from R packages by Hadley Wickham and Jennifer Bryan</a>.</p>
<div class="section level3">
<h3 id="geography-data-sets">Geography data sets<a class="anchor" aria-label="anchor" href="#geography-data-sets"></a></h3>
<p>In the package we export a number of data sets derived from the <a href="https://geoportal.statistics.gov.uk/" class="external-link">ONS Open Geography portal</a> for easy reuse within DfE analysis. Whenever new data appears or we want to make updates to these we need to do those manually.</p>
<div class="section level4">
<h4 id="source">Source<a class="anchor" aria-label="anchor" href="#source"></a></h4>
<p>Where we can, we use their API to get the data, so that we have completely reproducible pipelines for this (rather than saving static files manually and then having to check if updates have been made, or having to worry about file storage).</p>
<p>On the <a href="https://geoportal.statistics.gov.uk/" class="external-link">ONS Open Geography portal</a>, you will usually be looking for data published as a feature or feature layer, as these are the ones made available via the API connection. You’ll be able to preview the data in the browser and do basic searching / filtering on the table if you want to visualise it. Any feature data should have an option somewhere for ‘I want to use this data’ (or something similar if they update their website design) where you can get to an API explorer that allows you to run a basic query in the browser. In here you can usually find the dataset_id and also the parameters you want to use to get the data you need.</p>
<p>We have a <code><a href="reference/get_ons_api_data.html">get_ons_api_data()</a></code> function that acts as a wrapper to the ONS API, it does things like converting readable parameters into a query string and also handles batching and multiple requests if needed, so you get all of the data in one nice neat data frame (there’s a limit on the rows per single query for the API). Make use of this function first, though if you’re looking to expand on this function at all or there’s anything the <code><a href="reference/get_ons_api_data.html">get_ons_api_data()</a></code> function doesn’t do that you’d like it to, you should check if the <a href="https://github.com/francisbarton/boundr" class="external-link">boundr package</a> does what you need, as that gives a number of methods for extracting data from the portal as well. If neither our existing function or the boundr package do what you need, then we can look at raising a suggestion on dfeR if it’s a DfE specific request, or on boundr if it’s a more general request.</p>
<p>The way ONS publish has varied over their first few years of publishing, and on top of that each data set has an individual API connection for every year of boundaries. As there’s no link over time from the ONS side we have helper functions defined in R/datasets_utils.R that wrap these up into a single neat time series bundle for us. Given the likelihood of further variations, don’t be too surprised if adding new years to the data sets results in errors first time around, some manual fudgery is often needed so roll up your sleeves and prepare to get elbow deep into the murky depths of the R/datasets_utils.R file!</p>
<p>There is also some data we just define ourselves in code as we curate that, like custom regions we publish in DfE or our own lookup table for the shorthands used in the column names by ONS.</p>
</div>
<div class="section level4">
<h4 id="workflow-for-updating-geography-data">Workflow for updating geography data<a class="anchor" aria-label="anchor" href="#workflow-for-updating-geography-data"></a></h4>
<p>Our general workflow for data in the package is:</p>
<ol style="list-style-type: decimal"><li>Add a new year into the relevant script in data-raw/ script</li>
<li>Run the script to create a new data set</li>
<li>Run all package checks to make sure the data hasn’t gone all funky on you</li>
<li>Update any fetch_ functions that use the data if appropriate</li>
<li>Document any changes to the data set in R/datasets_documentation.R if appropriate</li>
</ol><p>Most data sets have tests that will fail as soon as the number of rows or columns change, this is both to provide a reliable service to users, but also to catch and remind us to maintain the documentation as the row number and all column names are defined in R/datasets_documentation.R. If these tests fail, update the relevant documentation, and then (ONLY THEN!) update the test expectations to match the new documentation.</p>
<p>The fetch_ family of functions in R/fetch.R act as quick helpers that pull from the data sets we export, so users can ees-ily grab say a list of all Scottish Parliamentary Constituencies for 2024, rather than needing to pull in a whole data frame and process it.</p>
<p>Often if adding a new year of data in, you will need to edit the year variables set near the start of the data-raw/ file and then also in the relevant fetch_ function @param year, as well as updating the public documentation of the data set in R/datasets_documentation.R.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="code-of-conduct">Code of Conduct<a class="anchor" aria-label="anchor" href="#code-of-conduct"></a></h2>
<p>Please note that the dfeR project is released with a <a href="CODE_OF_CONDUCT.html">Contributor Code of Conduct</a>. By contributing to this project you agree to abide by its terms.</p>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Cam Race, Laura Selby, Adam Robinson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

