---
title: "create_new_project"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{create_new_project}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup, include =  FALSE}
library(dfeR)
library(knitr)
```
---
title: "Creating a new dfeR project"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{create_new_project}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Introduction and pre-requisites

The dfeR package can be used to create a new R project using the create_project function. This function helps you set up a pre-populated project with a custom folder structure, making it easier to start your analysis or publication. In order to use this function, you will need to ensure you have the right software installed, and have an understanding of R projects and renv.

### Pre-requisites

Before you begin, ensure you have the following installed. 

-   R (version 4.0.0 or higher)
-   RStudio
-   The dfeR package

See information below for installing if you don't have these already.

### What is R studio?

RStudio is an integrated development environment (IDE) for R. It provides a user-friendly interface for writing and running R code, managing files, and visualising data. You can download R (language) and RStudio (IDE) from the DfE software center. We also recommend that you download RTools (a helpful R extension) at the same time.

### How do I install dfeR?

dfeR is available on CRAN and you can install directly from there by typing the below code into the console window in R studio:

```{r install_dfer, eval = FALSE}
install.packages("dfeR")
```

The [dfeR documentation](https://dfe-analytical-services.github.io/dfeR/index.html) gives more details on options for installing.

### What is an R Project?

An R project is a working directory designated for a specific analysis or project. It keeps all your scripts, data, functions and outputs together in one place. Rstudio allows you to switch between your projects easily, meaning you can keep your different pieces of work separate from each other.

Whenever you are using R studio, you should work in an R Project. This makes sure you are set up in the correct working directory, so your code is pointing at the right folders and files. You can find out more in [this guide for using projects in R](https://support.posit.co/hc/en-us/articles/200526207-Using-RStudio-Projects).

### What is renv?

Packages and versions of R regularly update. Over time, this can cause code to break - e.g. if different dependencies are required for later versions of packages to work. Using renv creates a “snapshot” of your code and packages at the time you created it, which anyone can then recreate when they come to use your code. This means that you can be sure that the code you wrote will work in the future, even if packages are updated.

You should use the renv package for package version control in R. It creates a project-specific library, meaning that installing a new or updated package for one project won't break your other projects. This is particularly useful for reproducibility and collaboration, as it ensures that your project will work with the same package versions on different machines. You can find out more about renv on the the [RStudio website](https://rstudio.r-universe.dev/renv#:~:text=A%20dependency%20management%20toolkit%20for%20R.%20Using%20%27renv%27%2C,make%20your%20projects%20more%20isolated%2C%20portable%2C%20and%20reproducible._). 

### What is testthat? 

## Using the create_project function

The create_project function is a part of the dfeR package and is used to create a new R project with a custom folder structure. It is designed to help you set up your project quickly and efficiently, with all the necessary components in place.

The function works by: 

1. *Setting up the core project structure* Depending on the parameters you choose, this may include folders for data, analysis, documentation, and output.

2. *Adding initial files* The script creates some initial files, such as a README file and a .gitignore file, to help you get started with your project. It also initialises the {testthat} package, which is used for unit testing in R. 

3. *Adding documentation* The function creates a README, which will be a template for a publication project or analysis, depending on the setting for create_publication_project. 

4. *Customisation* The project creates a github gitignore file if set to TRUE and initialises the {renv} package if set to TRUE.

Here is the basic code you will need to use, having installed dfeR:

```{r_create_project, eval = FALSE}
dfeR::create_project(
  path = "C:/path/to/your/new/project",
  init_renv = TRUE,
  include_structure_for_pkg = FALSE,
  create_publication_proj = FALSE,
  include_github_gitignore = TRUE
)
```

### Parameters

Below is a table describing the parameters used within the code. When using the create_project function, you will need to make a decision on what to enter for each in order to create the appropriate type of project.

```{r, echo = FALSE}
parameter_data <- data.frame(
  Parameter = c(
    "Path",
    "init_renv",
    "include_structure_for_pkg",
    "create_publication_proj",
    "include_github_gitignore"
  ),
  Meaning = c(
    "Folder pathway",
    "Initiate renv in the project",
    "Additional folder for package development",
    "Create project with structure for publications",
    "Include a github gitignore file"
  ),
  `Expected input` = c(
    "A folder path e.g. 'C:/Users/username/repos'",
    "Boolean (TRUE/FALSE), default = TRUE",
    "Boolean (TRUE/FALSE), default = FALSE",
    "Boolean (TRUE/FALSE), default = FALSE",
    "Boolean (TRUE/FALSE)"
  ),
  Considerations = c(
    "Where do you want to store your project?. You should store any projects that use Git outside of OneDrive. To create a folder in your C drive, type: 'C:/Users/username' into the file explorer search bar and create a folder                     called 'repos'.",
    "Do you want to use renv? renv helps manage the packages your project needs. Set to TRUE if you want to use it.",
    "Are you creating this project to work on a package? Set to TRUE if yes.",
    "Should the folder structure be for a publication project? Set to TRUE if yes or FALSE if it is for another type of analysis.",
    "Do you want to exclude certain files from being tracked by Git? Including a GitHub .gitignore file helps manage which files should not be included in version control, such as temporary files and sensitive information."
  ),
  Outout = c(
    "This will be the folder your new project is created within",
    "If set to TRUE, renv will be initialised in your project. A renv folder will be created, as well               as a renv.lock file.",
    "If set to TRUE, an additonal folder will be created specifically for package development",
    "If set to TRUE, a publication template folder structure will be created, with folders for data,                analysis, documentation etc. If set to FALSE, a basic analysis folder structure will be created,               with folders for data, analyis and output",
    "If set to TRUE, a github gitignore file will be created."
  )
)


kable(
  parameter_data,
  format = "markdown",
  col.names = c("Parameter", "Meaning", "Expected input", "Considerations", "Output")
)
```

You will also need to think about what you want your project to be called and include this in your file path. You can always amend this later.

For example, if you want to create a project called “my-new-project” in the folder you created above, your file path (with the username changed to your username) would be "C:/Users/Msmith/repos/my-new-project".

You can create a project in a different location, but you will need to change the file path accordingly.

### Example

```{r_function_example, eval = FALSE}
# Load the dfeR package
library(dfeR)
# Create a new project with the desired parameters
dfeR::create_project(
  path = "C:/Users/MSmith/repos/my-new-project",
  init_renv = TRUE,
  include_structure_for_pkg = FALSE,
  create_publication_proj = TRUE,
  include_github_gitignore = TRUE
)
```

The above code will create a new project in the specified folder path, with renv initialised, a publication project structure, and a GitHub gitignore file included. You can view this by going to the location of the pathway you chose in file explorer. You should find your new project there, inside a folder with the name you added at the end of your pathway, as below.

![Newly created contents of project folder in file explorer](create_new_project_screenshot.png)

You can then open the project by going to file \> open project in RStudio. You can amend the file structure and names to suit the particular project you are working on, using the file structure created as a template.

### Troubleshooting

You may hit an error if the `init_renv` parameter is not set to FALSE. This initiates `{renv}` in the created project, which is best practice. However, the `renv.lock` is set up to record several packages (`{rmarkdown}, {testthat}, {renv}, {stringr}`). You may get the following error message, letting you know that none of these packages are installed:

*"None of the packages recorded in the lockfile are currently installed."*

This can be rectified by executing `'renv::restore()'` in your console which will install those packages.
